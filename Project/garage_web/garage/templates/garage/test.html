<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">

    <!-- Title Page-->
    <title>Dashboard</title>

    {% load staticfiles %}
    <!-- Fontfaces CSS-->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/moonspam/NanumSquare@1.0/nanumsquare.css">

    <!-- Bootstrap CSS-->
    <link href="{% static 'garage/test/vendor/test_bootstrap.min.css' %}" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="{% static 'garage/test/css/theme_test.css' %}" rel="stylesheet" media="all">

    <!-- Google Chart-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

  function drawChart() {
    var data = google.visualization.arrayToDataTable({{ datas|safe }},true);

    var options = {
        tooltip: {isHtml: true},
      legend:'none',
        animation:{
          startup: true,
        duration: 500,
        easing: 'out',
      },
      chartArea: {
        width: '90%',
        height: '90%',
      },
        hAxis: {
            gridlines: {
                   color: '#333',
                   minSpacing: 20,
               },
            viewWindow:
                {
                    min:0,
                    max:365
                },
            showTextEvery: 49,
        },
        vAxis: {
            gridlines: {
                   color: '#333',
               },
        },
        candlestick:{
          fallingColor:{
              fill: 'blue',
              stroke: 'blue',
          },
          risingColor:{
              fill: 'red',
              stroke: 'red',
          }
        },
        colors: ['black'],
    };

 var chart = new google.visualization.CandlestickChart(
        document.getElementById('chart_div'));
    var MAX = 365;
    var prevButton = document.getElementById('b1');
    var nextButton = document.getElementById('b2');
    var changeZoomButton = document.getElementById('b3');
    function drawChart() {
      // Disabling the button while the chart is drawing.
      prevButton.disabled = true;
      nextButton.disabled = true;
      changeZoomButton.disabled = true;
      google.visualization.events.addListener(chart, 'ready',
          function() {
            prevButton.disabled = options.hAxis.viewWindow.min <= 0;
            nextButton.disabled = options.hAxis.viewWindow.max >= MAX;
            changeZoomButton.disabled = false;
          });
      chart.draw(data, options);
    }

    prevButton.onclick = function() {
      if (zoomed==0) {
        options.hAxis.viewWindow.min -= 1;
        options.hAxis.viewWindow.max -= 1;
      }
      else if(zoomed==1){
          options.hAxis.viewWindow.min -= 20;
          options.hAxis.viewWindow.max -= 20;
      }
      else if(zoomed==2) {
        options.hAxis.viewWindow.min -= 60;
        options.hAxis.viewWindow.max -= 60 ;
      }
      drawChart();
    }
    nextButton.onclick = function() {
      if (zoomed==0) {
        options.hAxis.viewWindow.min += 1;
        options.hAxis.viewWindow.max += 1;
      }
      else if(zoomed==1){
          options.hAxis.viewWindow.min += 20;
          options.hAxis.viewWindow.max += 20;
      }
      else if(zoomed==2) {
        options.hAxis.viewWindow.min += 60;
        options.hAxis.viewWindow.max +=60 ;
      }
      drawChart();
    }
    var zoomed = 2;
    changeZoomButton.onclick = function() {
      zoomed = zoomed+1;
      if(zoomed >2){
          zoomed=0;
          options.hAxis.showTextEvery=1;
      }

      if (zoomed==0) {
        options.hAxis.viewWindow.min = 0;
        options.hAxis.viewWindow.max = 7;
        options.hAxis.showTextEvery = 1;
      }
      else if(zoomed==1){
          options.hAxis.viewWindow.min=0;
          options.hAxis.viewWindow.max=60;
          options.hAxis.showTextEvery = 7;
      }
      else if(zoomed==2) {
        options.hAxis.viewWindow.min = 0;
        options.hAxis.viewWindow.max = MAX;
        options.hAxis.showTextEvery = 49;
      }
      drawChart();
    }
    drawChart();
  }
    </script>

<!--    Google Chart-->
     <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['table']});
      google.charts.setOnLoadCallback(drawTable);

      function drawTable() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', '거래일자');
        data.addColumn('string', '거래유형');
        data.addColumn('number', '가격');
        data.addColumn('number', '수량');
        data.addColumn('number', '수익률');
        data.addColumn('number', '자산증감률');
        data.addColumn('number', '전체잔고');
        //data.addRows([ ['2019-01-11', 'buy', '', '0.1%', '1.1%', '12345'],])
        data.addRows( {{trades|safe}} );

        var table = new google.visualization.Table(document.getElementById('table_div'));

        table.draw(data, {showRowNumber: false, width: '100%', height: '100%'});
      }
    </script>


        <script type='text/javascript'>
      google.charts.load('current', {'packages':['annotationchart']});
      google.charts.setOnLoadCallback(drawChart2);

      function drawChart2() {
        var data = new google.visualization.DataTable();
        data.addColumn('date', 'Date');
        data.addColumn('number', 'KRW-BTC in Upbit');
        data.addColumn('string', 'SEll/BUY');
        data.addColumn('string', 'info');
        // data.addColumn('number', 'MACD');
        // data.addColumn('number', 'RSI');
        // data.addRows([
        //   [new Date(2314, 2, 15), 12400, undefined, undefined,
        //                           ],
        //   [new Date(2314, 2, 16), 24045, 'sell', 'First encounter',
        //                           ],
        //   [new Date(2314, 2, 17), 35022, 'Lalibertines', 'They are very tall',
        //                           ],
        //   [new Date(2314, 2, 18), 12284, 'Lalibertines', 'Attack on our crew!',
        //                           ],
        //   [new Date(2314, 2, 19), 8476, 'Lalibertines', 'Heavy casualties',
        //                           ],
        //   [new Date(2314, 2, 20), 0, 'Lalibertines', 'All crew lost',
        //                           ],
        // ]);
        var i;
        temp = {{datas|safe}};
        trade_list = {{trades|safe}} ;
        var trade_index=0;
        var trade_length = trade_list.length
        for ( i=0 ; i< temp.length  ;i++)
        {
            if( trade_index < trade_length && temp[i][3] == trade_list[trade_index][0]){
                data.addRows([[new Date(temp[i][0], temp[i][1]-1, temp[i][2]), temp[i][6], trade_list[trade_index][1], trade_list[trade_index][3]+"btc",  ]]);
                trade_index = trade_index + 1
            }
            else{
                data.addRows([[new Date(temp[i][0], temp[i][1]-1, temp[i][2]), temp[i][6], undefined, undefined]]);
            }
        }

        var chart = new google.visualization.AnnotationChart(document.getElementById('chart_div2'));

        var options = {
          displayAnnotations: true,
            displayAnnotationsFilter: true,
            scaleColumns:[0,1,1],
            thickness:3,
            colors:['#6C63FF'],
        };

        chart.draw(data, options);
      }
    </script>

</head>

<body class="animsition">
    <div class="page-wrapper">
        <!-- HEADER MOBILE-->
        <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
            <div class="container">
                <img class="img" href="/" src="{% static 'garage/test/images/logo_box.png' %}" alt="" width="50" height="25">
                <a class="navbar-brand js-scroll-trigger" href="/">
                    <font size=4.5><B>&nbsp Algorithm Trading</B></font>
                </a>
                <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto my-2 my-lg-0">
                        <li class="nav-item">
                            <a class="nav-link js-scroll-trigger" href="#about">소개</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link js-scroll-trigger" href="#services">알고리즘 만들기</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link js-scroll-trigger" href="">알고리즘 관리</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link js-scroll-trigger" href="#contact">마켓플레이스</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link js-scroll-trigger"> </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- MAIN CONTENT-->
        <div class="main-content">
            <div class="section__content section__content--p30">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="overview-wrap">
                                <h2 class="title-2">백테스팅 결과</h2>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="row m-t-25">
                                <div class="col-sm-6 col-lg-3">
                                    <div class="overview-item overview-item--c1">
                                        <div class="overview__inner">
                                            <div class="overview-box clearfix">
                                                <div class="text">
                                                    <h2>손익 {{bal_diff|safe}}원</h2>
                                                    <span>투자원금 : {{init_bal|safe}}원<br>
                                                    현재자산 : {{fin_bal|safe}}원</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6 col-lg-3">
                                    <div class="overview-item overview-item--c2">
                                        <div class="overview__inner">
                                            <div class="overview-box clearfix">
                                                <div class="text">
                                                    <h2>수익률 {{fin_inc|safe}}%</h2>
                                                    <span>평가수익률 : {{fin_prf|safe}}%<br>
                                                    연환산수익률 : -%</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6 col-lg-3">
                                    <div class="overview-item overview-item--c3">
                                        <div class="overview__inner">
                                            <div class="overview-box clearfix">
                                                <div class="text">
                                                    <h2>거래 승률 -%</h2>
                                                    <span>승 : -건<br>
                                                    패 : -건</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6 col-lg-3">
                                    <div class="overview-item overview-item--c4">
                                        <div class="overview__inner">
                                            <div class="overview-box clearfix">
                                                <div class="text">
                                                    <h2>테스트 기간 </h2>
                                                    <span>{{st_date|safe}}~{{end_date|safe}}</span><br>
                                                    <h2>거래 횟수 {{trade_num|safe}}건 </h2>
                                                 
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="au-card recent-report ">
                                        <!-- 차트는 여기에 넣어주세용  -->
                                        <div id="chart_div2" style="width:100%; height:110%"></div>
<!--                                        <div class="row justify-content-center">-->
<!--                                            <button id="b1">prev</button>-->
<!--                                                <div>    &nbsp</div>-->
<!--                                             <button id="b2">next</button>-->
<!--                                                <div>    &nbsp</div><div>    &nbsp</div>-->
<!--                                             <button id="b3">zoom</button>-->
<!--                                        </div>-->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="col-lg-12">
                                <div class="row m-t-25">
                                    <div class="transaction-item">
                                        <div>
                                            <h2>거래내역 </h2>
                                            <a>&nbsp</a>
                                        </div>
                                    <!-- 거래내역은 여기에 넣어주세용  -->
                                        <div id="table_div" style="height:85%">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>
    <!-- END MAIN CONTENT-->
    <!-- END PAGE CONTAINER-->
    </div>

    </div>



</body>

</html>
<!-- end document-->
